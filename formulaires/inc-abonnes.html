<B_abonnes>
	#ANCRE_PAGINATION
	<div class="liste-objets vacarme envois abonnements">
		<table class="spip liste">
			[<caption><strong class="caption">[(#ENV{numero_reference}|vnumeros_convertir_reference_titre) : ](#GRAND_TOTAL|singulier_ou_pluriel{abonnement:info_1_abonnement_actif,abonnement:info_nb_abonnements_actifs})</strong></caption>]
			<thead>
				<tr class="first_row">
					<th class="">#</th>
					<th class="">Statut</th>
					<th class="titre"><:abonnements_offre:titre_abonnements_offre:></th>
					<th class="nom"><:abonnement:info_nom_auteur:></th>
					<th class="duree"><:abonnements_offre:champ_duree_label:></th>
					<th class="numero_debut"><:abonnement:champ_numero_debut_label:></th>
					<th class="numero_fin"><:abonnement:champ_numero_fin_label:></th>
					<th class="paiement"><:abonnement:champ_mode_paiement_label:></th>
					<th class="selection" scope="col"><:envois_commande:exporter_destinataire:>
						<!-- <a href="[(#SELF)]" class="check-all-trigger js-check-all-trigger">\[<span class="check-all-is-checked">X</span><span class="check-all-is-unchecked">&nbsp;</span>\]</a> -->
					</th>
				</tr>
			</thead>
			<tbody>
			<BOUCLE_abonnes(ABONNEMENTS){statut=actif}{numero_debut<=#ENV{numero_reference}}{numero_fin>=#ENV{numero_reference}}{par numero_debut}{pagination #ENV{nb, 20}}>
				<tr class="[(#COMPTEUR_BOUCLE|alterner{row_odd,row_even})]">
					<td class=""><a href="[(#ID_ABONNEMENT|generer_url_entite{abonnement})]">#ID_ABONNEMENT</a></td>
					<td class="[statut_(#STATUT)]"><:abonnement:texte_statut_{=#STATUT}:></td>
					<td class="titre">[(#INFO_TITRE{abonnements_offre, #ID_ABONNEMENTS_OFFRE})]</td>
					<td class="nom"><a href="[(#ID_AUTEUR|generer_url_entite{auteur})]">[(#INFO_NOM{auteur, #ID_AUTEUR})]</a></td>
					<td class="duree">[(#INFO_DUREE{abonnements_offre, #ID_ABONNEMENTS_OFFRE}|duree_en_clair)]</td>
					<td class="numero_debut">[(#NUMERO_DEBUT|replace{'v', ''}|ltrim{'0'})]</td>
					<td class="numero_fin">[(#NUMERO_FIN|replace{'v', ''}|ltrim{'0'})]</td>
					<td class="paiment">[(#MODE_PAIEMENT|paiement_en_clair)]</td>
					<td class="selection">
						<div class="check">
							[(#ID_ABONNEMENT|in_any{#ENV{ids_abonnement}}|oui)#ID_ABONNEMENT)]
							<input type="checkbox" class="checkbox" name="ids_abonnement\[\]" value="#ID_ABONNEMENT"
							[(#ID_ABONNEMENT|in_any{#ENV{ids_abonnement}}) checked="checked"] />
						</div>
					</td>
				</tr>
			</BOUCLE_abonnes>
			</tbody>
		</table>
		[<p class="pagination">(#PAGINATION{prive})</p>]
		<script type="text/javascript">
		/*<![CDATA[*/
			(function($){
				var $form = $(".formulaire_export_envois_abonnements"),
					$checkboxs = $form.find('input[type=checkbox]'),
					$trigger = $('.js-check-all-trigger'),
					$hidden = $form.find('#js-hidden'),
					_ids = [];

				if ($hidden.val().length) {
					var ids = JSON.parse($hidden.val());
					ids.forEach(function(el){
						_ids.push(el);
						$checkboxs.each(function(){
							if (el == $(this).attr('value')) {
								$(this).prop('checked', true);
							}
						});
					});
				}
				
				// $trigger.click(function(e){
				// 	e.preventDefault();
				// 	$(this).toggleClass('is-checked');
				// 	if ($(this).hasClass('is-checked')) {
				// 		$checkboxs.prop('checked', true).change();
				// 	} else {
				// 		$checkboxs.prop('checked', false).change();
				// 	}
				// });
				
				$checkboxs.click(function(){
					var val = $(this).val();
					if ($(this).prop('checked')) {
						_ids.push(val);
					} else {
						var index = _ids.indexOf(val);
						if (index > -1) {
							_ids.splice(index, 1);
						}
					}
					var ids = JSON.stringify(_ids);
					$hidden.val('').val(ids);
				});
				
				// $checkboxs.change(function(){
				// 	// ids.push($(this).val());
				// 	// _ids = JSON.stringify(ids);
				// 	// $hidden.val('').val(_ids);
				// 	// if (!$form.find('> input.submit').length) {
				// 	// 	$form.find('.boutons.action').slideDown()
				// 	// 		.find('input.submit').clone().addClass('invisible')
				// 	// 		.prependTo($form);
				// 	// }
				// });
				
			})(jQuery);
		/*]]>*/
		</script>
	</div>
</B_abonnes>
